{% extends 'dashboard/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="row">
        <div class="col-xl-4">
            <h2>Available Investment Plans</h2>

            {% if investment_plans %}
                <form method="post" action="{% url 'investment' %}">
                    {% csrf_token %}
                    {{ form|crispy }}

                    <input type="hidden" name="selected_plan" value="{{ selected_plan.plan.id }}">

                    <button type="submit" class="btn btn-primary">Invest</button>
                </form>
            {% else %}
                <p>No available investment plans.</p>
            {% endif %}

            {% if selected_plan %}
                <h2>Selected Plan: {{ selected_plan.plan.name }}</h2>
                <p>Description: {{ selected_plan.plan.description }}</p>
                <p>Daily Profit (%): {{ selected_plan.plan.daily_profit_percentage }}</p>
            {% endif %}
        </div>
        {% if active_investments %}
            <h2>Active Investments</h2>
            <div class="row">
                {% for investment in active_investments %}
                    <div class="col-md-4">
                        <ul>
                            <li>
                                <p>Investment plan: {{ investment.investment_plan }}</p>
                                <p>Amount: {{ investment.amount }} {{ investment.currency }}</p>
                                <p>Days passed: {{ investment.days_passed }}</p>
                                <p>The next interest: {{ investment.next_updated }} </p>

                                <form method="post" action="{% url 'cancel_investment' investment.pk %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger">Cancel Investment</button>
                                </form>

                                <form method="post" action="{% url 'add_funds' investment.pk %}">
                                    {% csrf_token %}
                                    <input type="number" name="amount" min="0" step="0.01" required>
                                    <button type="submit" class="btn btn-primary">Add Funds</button>
                                </form>
                            </li>


                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>You have no active investments.</p>
        {% endif %}
    </div>
{% endblock %}